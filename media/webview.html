<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="table.css">
</head>
<body>
  <div id="table-container">
    <table id="tsv-table">
      <!-- Table will be generated by JavaScript -->
    </table>
  </div>
  
  <script>
    const vscode = acquireVsCodeApi();
    
    // Render table from structured data
    function renderTable(tableData, dimensions) {
      const table = document.getElementById('tsv-table');
      table.innerHTML = '';
      
      tableData.forEach((row, rowIndex) => {
        const tr = document.createElement('tr');
        
        row.forEach((cellValue, colIndex) => {
          const td = document.createElement('td');
          const input = document.createElement('input');
          input.type = 'text';
          input.className = 'cell-input';
          input.value = cellValue || '';
          input.dataset.row = rowIndex;
          input.dataset.col = colIndex;
          
          // Handle cell edits
          input.addEventListener('input', handleCellEdit);
          
          td.appendChild(input);
          tr.appendChild(td);
        });
        
        table.appendChild(tr);
      });
    }
    
    // Handle individual cell edit
    function handleCellEdit(event) {
      const input = event.target;
      const row = parseInt(input.dataset.row);
      const col = parseInt(input.dataset.col);
      
      // Send cell edit to provider
      vscode.postMessage({ 
        type: 'cellEdit', 
        data: {
          position: { row, col },
          value: input.value
        }
      });
    }
    
    // Listen for messages from provider
    window.addEventListener('message', event => {
      if (event.data.type === 'init') {
        const { table, dimensions } = event.data.data;
        renderTable(table, dimensions);
      }
    });
  </script>
</body>
</html>
